# Research - Local Mode Documentation Gaps

**Date:** 2026-01-08T14:14:39-06:00
**Owner:** agent
**Phase:** Research

## Goal

Map documentation gaps for the local mode feature (PRs #215, #216) and determine where to link local mode docs in the main README.

- Related Commits:
  - `98b5e01` feat: local mode + configurable tool limits (#215)
  - `529f138` feat: tool improvements, local mode, and BaseToolRenderer pattern (#216)
  - `cb5a456` feat: add local_mode for small context window models

## Findings

### Implementation Files (All Documented Correctly)

| File | Purpose |
|------|---------|
| `src/tunacode/core/limits.py` | Centralized limit config with `is_local_mode()` |
| `src/tunacode/constants.py` | Local mode constants (LOCAL_DEFAULT_READ_LIMIT, etc.) |
| `src/tunacode/core/compaction.py` | Aggressive pruning thresholds |
| `src/tunacode/core/agents/agent_components/agent_config.py` | Tool set selection, template selection |
| `src/tunacode/core/prompting/templates.py` | LOCAL_TEMPLATE definition |
| `src/tunacode/core/prompting/local_prompt.md` | Condensed guide file for local models |

### Documentation Status

| Document | Status | Notes |
|----------|--------|-------|
| `docs/configuration/README.md` | ACCURATE | Local mode section complete (lines 45-91) |
| `docs/codebase-map/modules/core-limits.md` | ACCURATE | Documents all limit functions |
| `docs/codebase-map/modules/core-compaction.md` | ACCURATE | Documents pruning thresholds |
| `docs/codebase-map/modules/core-prompting.md` | INCOMPLETE | Missing LOCAL_TEMPLATE |
| `docs/codebase-map/modules/core-agents.md` | INCOMPLETE | Missing local mode tool set |
| `README.md` | MISSING LINK | No reference to local mode or config docs |

## Key Patterns / Solutions Found

### Configuration Docs Verified Accurate

All values in `docs/configuration/README.md` match code:
- `LOCAL_DEFAULT_READ_LIMIT = 200`
- `LOCAL_MAX_COMMAND_OUTPUT = 1500`
- `LOCAL_MAX_LINE_LENGTH = 500`
- `LOCAL_MAX_FILES_IN_DIR = 20`
- `local_max_tokens = 1000` default
- 6 tools in local mode (bash, read_file, update_file, write_file, glob, list_dir)

### README Link Location

Best place to add local mode reference in `README.md`:

**Option A (Recommended):** Add "Documentation" section after Commands table:

```markdown
## Documentation

- [Configuration Guide](docs/configuration/README.md) - API keys, settings, local mode
```

**Option B:** Expand existing Configuration section:

```markdown
## Configuration

Set your API key as an environment variable or use the setup wizard:
...

For advanced settings including **local mode** (small context window models), see [Configuration Guide](docs/configuration/README.md).
```

## Knowledge Gaps / Documentation Debt

### 1. core-prompting.md Missing LOCAL_TEMPLATE

**Location:** `docs/codebase-map/modules/core-prompting.md`

**Current (line 32-35):**
```markdown
**Templates:**
- **MAIN_TEMPLATE** - Standard agent prompt structure
- **RESEARCH_TEMPLATE** - Research agent prompt structure
- **TEMPLATE_OVERRIDES** - Model-specific variations
```

**Should Include:**
- LOCAL_TEMPLATE (3 sections: AGENT_ROLE, TOOL_USE, USER_INSTRUCTIONS)
- Template selection logic (is_local_mode() check)
- local_prompt.md file reference

### 2. core-prompting.md Missing Exports

**Current exports (line 7):**
```yaml
exports: [PromptingEngine, SectionLoader, compose_prompt, SystemPromptSection]
```

**Actual exports:**
```yaml
exports: [PromptingEngine, get_prompting_engine, resolve_prompt, compose_prompt, SystemPromptSection, LOCAL_TEMPLATE, MAIN_TEMPLATE, RESEARCH_TEMPLATE, TEMPLATE_OVERRIDES, SectionLoader]
```

### 3. core-agents.md Missing Local Mode Details

No documentation of:
- Minimal tool set (6 tools vs 11 tools)
- 1-word tool descriptions to save tokens
- Exclusion of delegation/todo tools in local mode
- `load_tunacode_context()` local mode behavior

### 4. Missing Cross-References

- README.md has no link to configuration docs
- Configuration docs have no link to codebase-map modules

## Recommended Actions

### Priority 1: Link in Main README

Add to `README.md` after line 77 (after Configuration section):

```markdown
For advanced settings including **local mode** for small context models, see the [Configuration Guide](docs/configuration/README.md).
```

### Priority 2: Update core-prompting.md

1. Add LOCAL_TEMPLATE to Templates section
2. Update exports list in frontmatter
3. Add local_prompt.md to section files
4. Update prompt composition flow to show 3-way template selection

### Priority 3: Update core-agents.md

1. Document local mode tool set differences
2. Document `load_tunacode_context()` dual behavior

## References

- `docs/configuration/README.md` - Primary local mode config docs
- `docs/codebase-map/modules/core-limits.md` - Limits module docs
- `docs/codebase-map/modules/core-compaction.md` - Compaction docs
- `docs/codebase-map/modules/core-prompting.md` - Prompting docs (needs update)
- `.claude/JOURNAL.md` - Local mode implementation notes
