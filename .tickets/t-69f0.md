---
id: t-69f0
status: closed
deps: []
links: []
created: 2026-01-26T06:04:22Z
type: task
priority: 2
tags: [architecture, boundaries, callbacks, protocols, types]
---
# Enforce boundary contracts between UI, core, and tools

Boundary contracts between UI, core, and tools are partially implicit: several callbacks and tool entry points are typed as Any or use broad protocols, so the contract is not enforced by typing or tests. This makes boundary drift harder to detect and allows accidental coupling across layers.

Root cause: Contracts were defined informally via usage instead of explicit callback type aliases and minimal protocols.

Acceptance criteria:
1. Define explicit callback type aliases for tool results, plan approval, and streaming in types/
2. Narrow StateManagerProtocol into per-tool protocols (todo, plan approval, authorization)
3. Update tool factories and UI hooks to accept only the minimal protocols and callbacks
4. All callback surfaces typed - no Any allowed at boundaries
5. pyright/mypy passes on boundary modules

Reference: .claude/delta/2026-01-26_boundary-contracts-not-enforced.md
